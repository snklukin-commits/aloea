<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –°–ó: –í–æ–∑–º–µ—â–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Times+New+Roman&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* A4 Paper Simulation */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            font-family: 'Times New Roman', serif;
            font-size: 12pt;
            line-height: 1.15;
            color: #000;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Docx Header Table Grid */
        .doc-header-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 50% / 50% split */
            gap: 0 20px;
            margin-bottom: 5px;
        }
        
        .doc-col {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .doc-line {
            min-height: 1.2em;
        }

        /* Input Styling */
        .input-field {
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: #009245;
            box-shadow: 0 0 0 3px rgba(0, 146, 69, 0.1);
        }

        /* Signature Image Simulation - DOUBLED SIZE */
        .signature-img {
            position: absolute;
            bottom: -15px; /* Adjusted to sit naturally over the line */
            left: 50%;
            transform: translateX(-50%);
            /* Increased sizes (approx 2x original) */
            max-height: 120px; 
            max-width: 280px;
            /* Magic for removing white background from JPG scans */
            mix-blend-mode: multiply; 
            pointer-events: none;
        }

        /* Print Specifics */
        @media print {
            body {
                background: white;
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            .a4-page {
                box-shadow: none;
                margin: 0;
                width: 100%;
                height: auto;
                page-break-after: always;
                padding: 10mm 15mm;
                display: block;
            }
            @page {
                size: A4;
                margin: 0;
            }
        }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 h-16 flex-none no-print z-20 shadow-sm">
        <div class="container mx-auto px-4 h-full flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-green-600 rounded flex items-center justify-center text-white font-bold text-lg">A</div>
                <h1 class="text-xl font-medium text-gray-700">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É–∂–µ–±–Ω—ã—Ö –∑–∞–ø–∏—Å–æ–∫</h1>
            </div>
            <div class="flex gap-3">
                <button onclick="window.print()" class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                    <span>üñ®Ô∏è –ü–µ—á–∞—Ç—å</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Left Panel: Controls -->
        <aside class="w-full md:w-[350px] bg-white border-r border-gray-200 overflow-y-auto no-print flex flex-col z-10 shadow-[4px_0_24px_rgba(0,0,0,0.02)]">
            <div class="p-6">
                <!-- Introduction -->
                <div class="mb-6 bg-green-50 p-4 rounded-lg border border-green-100">
                    <h2 class="text-green-800 font-semibold text-sm mb-1">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞</h2>
                    <p class="text-xs text-green-600 leading-relaxed">
                        –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è.
                    </p>
                </div>

                <form id="docForm" class="space-y-4">
                    <!-- Signature Control -->
                    <div class="space-y-3 border-b border-gray-100 pb-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ü–æ–¥–ø–∏—Å—å</h3>
                        <div class="flex items-center gap-2 mb-2">
                            <input type="checkbox" id="signCheckbox" class="w-4 h-4 text-green-600 rounded border-gray-300 focus:ring-green-500">
                            <label for="signCheckbox" class="text-sm text-gray-700 font-medium select-none cursor-pointer">–í—Å—Ç–∞–≤–∏—Ç—å —Å–∫–∞–Ω –ø–æ–¥–ø–∏—Å–∏</label>
                        </div>
                        
                        <!-- File Upload (Hidden unless checked) -->
                        <div id="signUploadContainer" class="hidden animate-fade-in transition-all">
                            <label class="block text-xs text-gray-500 mb-1">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG/PNG):</label>
                            <input type="file" id="signFileInput" accept="image/*" 
                                class="block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 cursor-pointer">
                            <p class="text-[10px] text-gray-400 mt-1 italic">–ë–µ–ª—ã–π —Ñ–æ–Ω —Å—Ç–∞–Ω–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
                        </div>
                    </div>

                    <!-- Key Personnel -->
                    <div class="space-y-3 border-b border-gray-100 pb-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ê–¥—Ä–µ—Å–∞—Ç (–ö–æ–º—É)</h3>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–§–ò–û</label>
                            <input type="text" id="directorInput" value="–ë–æ—á–∞—Ä–æ–≤–æ–π –ê.–í." 
                                class="input-field w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-sm text-gray-800">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                            <input type="text" id="directorTitleInput" value="–î–∏—Ä–µ–∫—Ç–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä" 
                                class="input-field w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-xs text-gray-500">
                        </div>
                    </div>

                    <div class="space-y-3 border-b border-gray-100 pb-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ó–∞—è–≤–∏—Ç–µ–ª—å (–û—Ç –∫–æ–≥–æ)</h3>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–§–ò–û</label>
                            <input type="text" id="employeeInput" value="–ö–ª—é–∫–∏–Ω –°.–ù." 
                                class="input-field w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-sm text-gray-800">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                            <input type="text" id="employeeTitleInput" value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä" 
                                class="input-field w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-xs text-gray-500">
                        </div>
                    </div>

                    <!-- Copy Recipients -->
                     <div class="space-y-3 border-b border-gray-100 pb-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ö–æ–ø–∏—è (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</h3>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–ö–æ–º—É (–§–ò–û)</label>
                            <input type="text" id="copyToInput" value="–õ–µ–æ–Ω–æ–≤–æ–π –û.–í."
                                class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm text-gray-800">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                            <input type="text" id="copyTitleInput" value="–ë—É—Ö–≥–∞–ª—Ç–µ—Ä" 
                                class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm text-gray-800">
                        </div>
                     </div>

                    <div class="space-y-3 border-b border-gray-100 pb-4">
                         <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">–ù–æ–º–µ—Ä–∞ –∏ –î–∞—Ç—ã</h3>
                         <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">–î–∞—Ç–∞ –¥–æ–∫-—Ç–∞</label>
                                <input type="date" id="dateInput" 
                                    class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm text-gray-800">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">–ò—Å—Ö. ‚Ññ</label>
                                <input type="text" id="outNumInput" placeholder="__" 
                                    class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm text-gray-800">
                            </div>
                         </div>
                    </div>

                    <!-- Financial Details -->
                    <div class="space-y-3 pb-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">–î–µ—Ç–∞–ª–∏ –†–∞—Å—Ö–æ–¥–∞</h3>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–°—É–º–º–∞ (–†—É–±.)</label>
                            <input type="number" id="amountInput" value="3981.97" step="0.01" min="0"
                                class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-bold text-green-700">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–û–±—ä–µ–∫—Ç (–ê–ø—Ç–µ–∫–∞/–û—Ñ–∏—Å)</label>
                            <input type="text" id="objectInput" value="–∞–ø—Ç–µ–∫–∏ 1109-52" 
                                class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</label>
                            <input type="text" id="addressInput" value="–≥. –ù.–ù–æ–≤–≥–æ—Ä–æ–¥, –°–æ—Ä–º–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 1–î" 
                                class="input-field w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm">
                        </div>
                    </div>
                </form>

            </div>
        </aside>

        <!-- Right Panel: Document Preview -->
        <main class="flex-1 bg-gray-100 overflow-y-auto p-4 md:p-8 flex justify-center items-start">
            
            <!-- A4 Document Wrapper -->
            <div id="documentPage" class="a4-page animate-fade-in-up">
                
                <!-- 1. HEADER SECTION -->
                <div class="flex-none">
                    <!-- Title -->
                    <div class="text-center font-bold text-[14pt] uppercase mb-4">
                        –°–õ–£–ñ–ï–ë–ù–ê–Ø –ó–ê–ü–ò–°–ö–ê
                    </div>

                    <!-- Header Grid: Left Col & Right Col -->
                    <div class="doc-header-grid text-[11pt]">
                        
                        <!-- LEFT COLUMN -->
                        <div class="doc-col">
                            <!-- Row 1: Numbers -->
                            <div class="doc-line">–ò—Å—Ö. ‚Ññ <span id="previewOutNum">__</span></div>
                            
                            <!-- Row 2: Dates -->
                            <div class="doc-line mt-2">–æ—Ç <span id="previewDateFull">¬´20¬ª —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥.</span></div>

                            <!-- Row 3: From Info -->
                            <div class="doc-line mt-4">–û—Ç –∫–æ–≥–æ: <span id="previewEmployeeName" class="font-bold">–ö–ª—é–∫–∏–Ω –°.–ù.</span></div>
                            <div class="doc-line">–î–æ–ª–∂–Ω–æ—Å—Ç—å: <span id="previewEmployeeTitle" class="italic">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</span></div>
                            
                            <!-- Row 4: Phone (Placeholder) -->
                            <div class="doc-line mt-8">–¢–µ–ª–µ—Ñ–æ–Ω:</div>
                        </div>

                        <!-- RIGHT COLUMN -->
                        <div class="doc-col">
                            <!-- Row 1: Numbers -->
                            <div class="doc-line">–í—Ö. ‚Ññ <span id="previewInNum">__</span></div>
                            
                            <!-- Row 2: Dates -->
                            <div class="doc-line mt-2">–æ—Ç ¬´___¬ª ___________ 20__</div>

                            <!-- Row 3: To Info -->
                            <div class="doc-line mt-4">–ö–æ–º—É: <span id="previewDirectorName" class="font-bold">–ë–æ—á–∞—Ä–æ–≤–æ–π –ê.–í.</span></div>
                            <div class="doc-line">–î–æ–ª–∂–Ω–æ—Å—Ç—å: <span id="previewDirectorTitle" class="italic">–î–∏—Ä–µ–∫—Ç–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä</span></div>
                            
                            <!-- Row 4: Copy Info (Inserted HERE between positions) -->
                            <div class="doc-line mt-2">–ö–æ–º—É (–∫–æ–ø–∏—è): <span id="previewCopyTo"></span></div>
                            <div class="doc-line">–î–æ–ª–∂–Ω–æ—Å—Ç—å: <span id="previewCopyTitle"></span></div>
                            
                            <!-- Row 5: Phone (Placeholder) -->
                            <div class="doc-line mt-2">–¢–µ–ª–µ—Ñ–æ–Ω:</div>
                        </div>

                    </div>

                    <!-- Subject Line -->
                    <div class="font-medium text-[12pt] mt-4 mb-2">
                        –ü—Ä–µ–¥–º–µ—Ç: –¢–ú–¶
                    </div>
                </div>

                <!-- 2. SEPARATOR LINE -->
                <div class="w-full border-b border-black mb-4"></div>

                <!-- 3. BODY SECTION -->
                <div class="flex-1 flex flex-col pt-24">
                    
                    <!-- Text Content -->
                    <div class="text-justify mb-8 indent-12 leading-relaxed text-[12pt]">
                        –ü—Ä–æ—à—É –≤–æ–∑–º–µ—Å—Ç–∏—Ç—å –¥–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ —Ö–æ–∑.—Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è 
                        <span id="previewObject">–∞–ø—Ç–µ–∫–∏ 1109-52</span>, 
                        <span id="previewAddress">–≥. –ù.–ù–æ–≤–≥–æ—Ä–æ–¥, –°–æ—Ä–º–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 1–î</span>.
                    </div>

                    <div class="text-justify mb-2 leading-relaxed text-[12pt]">
                        –°—É–º–º–∞ –∫ –≤–æ–∑–º–µ—â–µ–Ω–∏—é ‚Äì <span id="previewAmountNum" class="font-bold">3 981,97</span> —Ä—É–±.
                    </div>
                    
                    <div class="text-justify italic mb-8 bg-gray-50 p-2 border border-gray-100 print:bg-transparent print:border-0 print:p-0 text-[12pt]">
                        (<span id="previewAmountText">—Ç—Ä–∏ —Ç—ã—Å—è—á–∏ –¥–µ–≤—è—Ç—å—Å–æ—Ç –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç –æ–¥–∏–Ω —Ä—É–±–ª—å –¥–µ–≤—è–Ω–æ—Å—Ç–æ —Å–µ–º—å –∫–æ–ø–µ–µ–∫</span>)
                    </div>

                    <div class="mb-12 text-[12pt]">
                        –ß–µ–∫–∏ –ø—Ä–∏–ª–∞–≥–∞—é.
                    </div>
                </div>

                <!-- 4. FOOTER SECTION -->
                <div class="flex-none mt-auto">
                    <div class="flex justify-between items-end text-[12pt]">
                        <div id="previewEmployeeTitleSig" class="w-1/3">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</div>
                        
                        <!-- Signature Area -->
                        <div class="w-1/3 border-b border-black h-8 relative mx-4 flex items-end justify-center">
                            <!-- Image container (positioned absolutely) -->
                            <div id="signatureContainer" class="hidden">
                                <img id="signatureImage" src="" alt="–ü–æ–¥–ø–∏—Å—å" class="signature-img">
                            </div>
                        </div>
                        
                        <div id="previewEmployeeNameSig" class="w-1/3 text-right">–ö–ª—é–∫–∏–Ω –°.–ù.</div>
                    </div>
                </div>

            </div>
        </main>

    </div>

    <!-- Logic -->
    <script>
        // --- 1. State Management ---
        const state = {
            director: "–ë–æ—á–∞—Ä–æ–≤–æ–π –ê.–í.",
            directorTitle: "–î–∏—Ä–µ–∫—Ç–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä",
            employee: "–ö–ª—é–∫–∏–Ω –°.–ù.",
            employeeTitle: "–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä",
            copyTo: "–õ–µ–æ–Ω–æ–≤–æ–π –û.–í.",
            copyTitle: "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä",
            date: new Date().toISOString().split('T')[0],
            outNum: "__",
            amount: 3981.97,
            object: "–∞–ø—Ç–µ–∫–∏ 1109-52",
            address: "–≥. –ù.–ù–æ–≤–≥–æ—Ä–æ–¥, –°–æ—Ä–º–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 1–î"
        };

        // --- 2. Number to Text Logic (Russian) ---
        const numToText = (number) => {
            if (number === 0) return "–Ω–æ–ª—å —Ä—É–±–ª–µ–π 00 –∫–æ–ø–µ–µ–∫";

            const units = ['', '–æ–¥–∏–Ω', '–¥–≤–∞', '—Ç—Ä–∏', '—á–µ—Ç—ã—Ä–µ', '–ø—è—Ç—å', '—à–µ—Å—Ç—å', '—Å–µ–º—å', '–≤–æ—Å–µ–º—å', '–¥–µ–≤—è—Ç—å'];
            const teens = ['–¥–µ—Å—è—Ç—å', '–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å', '–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å', '—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å', '—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å', '–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å', '—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å', '—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å', '–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å', '–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å'];
            const tens = ['', '', '–¥–≤–∞–¥—Ü–∞—Ç—å', '—Ç—Ä–∏–¥—Ü–∞—Ç—å', '—Å–æ—Ä–æ–∫', '–ø—è—Ç—å–¥–µ—Å—è—Ç', '—à–µ—Å—Ç—å–¥–µ—Å—è—Ç', '—Å–µ–º—å–¥–µ—Å—è—Ç', '–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç', '–¥–µ–≤—è–Ω–æ—Å—Ç–æ'];
            const hundreds = ['', '—Å—Ç–æ', '–¥–≤–µ—Å—Ç–∏', '—Ç—Ä–∏—Å—Ç–∞', '—á–µ—Ç—ã—Ä–µ—Å—Ç–∞', '–ø—è—Ç—å—Å–æ—Ç', '—à–µ—Å—Ç—å—Å–æ—Ç', '—Å–µ–º—å—Å–æ—Ç', '–≤–æ—Å–µ–º—å—Å–æ—Ç', '–¥–µ–≤—è—Ç—å—Å–æ—Ç'];

            const morph = (n, f1, f2, f5) => {
                n = Math.abs(n) % 100;
                const n1 = n % 10;
                if (n > 10 && n < 20) return f5;
                if (n1 > 1 && n1 < 5) return f2;
                if (n1 === 1) return f1;
                return f5;
            };

            const convertGroup = (n, gender) => {
                let res = "";
                const h = Math.floor(n / 100);
                const t = Math.floor((n % 100) / 10);
                const u = n % 10;

                if (h > 0) res += hundreds[h] + " ";
                
                if (t === 1) {
                    res += teens[u] + " ";
                } else {
                    if (t > 1) res += tens[t] + " ";
                    if (u > 0) {
                        if (gender === 'female' && u === 1) res += "–æ–¥–Ω–∞ ";
                        else if (gender === 'female' && u === 2) res += "–¥–≤–µ ";
                        else if (gender === 'male' && u === 1) res += "–æ–¥–∏–Ω ";
                        else if (gender === 'male' && u === 2) res += "–¥–≤–∞ ";
                        else res += units[u] + " ";
                    }
                }
                return res;
            };

            let rub = Math.floor(number);
            let kop = Math.round((number - rub) * 100);

            let text = "";

            // Thousands
            const th = Math.floor(rub / 1000);
            if (th > 0) {
                text += convertGroup(th, 'female') + morph(th, "—Ç—ã—Å—è—á–∞", "—Ç—ã—Å—è—á–∏", "—Ç—ã—Å—è—á") + " ";
                rub %= 1000;
            }

            // Units
            text += convertGroup(rub, 'male');
            text += morph(rub, "—Ä—É–±–ª—å", "—Ä—É–±–ª—è", "—Ä—É–±–ª–µ–π");

            // Kopecks
            let kopText = "";
            kopText += convertGroup(kop, 'female');
            kopText += morph(kop, "–∫–æ–ø–µ–π–∫–∞", "–∫–æ–ø–µ–π–∫–∏", "–∫–æ–ø–µ–µ–∫");

            return (text + " " + kopText).trim();
        };

        // --- 3. Signature Logic ---
        function setupSignatureLogic() {
            const checkbox = document.getElementById('signCheckbox');
            const uploadContainer = document.getElementById('signUploadContainer');
            const fileInput = document.getElementById('signFileInput');
            const sigContainer = document.getElementById('signatureContainer');
            const sigImage = document.getElementById('signatureImage');

            // Toggle visibility
            checkbox.addEventListener('change', (e) => {
                if (e.target.checked) {
                    uploadContainer.classList.remove('hidden');
                    sigContainer.classList.remove('hidden');
                } else {
                    uploadContainer.classList.add('hidden');
                    sigContainer.classList.add('hidden');
                    sigImage.src = ''; // Clear image when unchecked if desired, or keep as memory
                    fileInput.value = ''; // Reset file input
                }
            });

            // Handle File Upload
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        sigImage.src = event.target.result;
                    }
                    reader.readAsDataURL(file);
                }
            });
        }


        // --- 4. Document Update Logic ---
        function updateDocument() {
            // Update State
            state.director = document.getElementById('directorInput').value;
            state.directorTitle = document.getElementById('directorTitleInput').value;
            state.employee = document.getElementById('employeeInput').value;
            state.employeeTitle = document.getElementById('employeeTitleInput').value;
            state.copyTo = document.getElementById('copyToInput').value;
            state.copyTitle = document.getElementById('copyTitleInput').value;
            state.date = document.getElementById('dateInput').value;
            state.outNum = document.getElementById('outNumInput').value || "__";
            state.amount = parseFloat(document.getElementById('amountInput').value) || 0;
            state.object = document.getElementById('objectInput').value;
            state.address = document.getElementById('addressInput').value;

            // Render Preview
            document.getElementById('previewDirectorName').textContent = state.director;
            document.getElementById('previewDirectorTitle').textContent = state.directorTitle;
            
            document.getElementById('previewEmployeeName').textContent = state.employee;
            document.getElementById('previewEmployeeTitle').textContent = state.employeeTitle;
            
            // Signature
            document.getElementById('previewEmployeeTitleSig').textContent = state.employeeTitle;
            document.getElementById('previewEmployeeNameSig').textContent = state.employee;

            document.getElementById('previewCopyTo').textContent = state.copyTo;
            document.getElementById('previewCopyTitle').textContent = state.copyTitle;

            document.getElementById('previewObject').textContent = state.object;
            document.getElementById('previewAddress').textContent = state.address;
            document.getElementById('previewOutNum').textContent = state.outNum;

            // Date Formatting for Header
            if (state.date) {
                const d = new Date(state.date);
                const months = ['—Å–µ–Ω—Ç—è–±—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
                document.getElementById('previewDateFull').innerHTML = `¬´${d.getDate().toString().padStart(2, '0')}¬ª ${months[d.getMonth()]} ${d.getFullYear()} –≥.`;
            } else {
                document.getElementById('previewDateFull').innerHTML = `¬´___¬ª __________ 20__ –≥.`;
            }

            // Amount Formatting
            document.getElementById('previewAmountNum').textContent = state.amount.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('previewAmountText').textContent = numToText(state.amount);
        }

        // --- 5. Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial Date input to 2025-09-20 (per doc example)
            document.getElementById('dateInput').valueAsDate = new Date("2025-09-20");

            // Setup Signature
            setupSignatureLogic();

            // Add Listeners
            const inputs = document.querySelectorAll('input:not(#signFileInput):not(#signCheckbox)');
            inputs.forEach(input => {
                input.addEventListener('input', updateDocument);
            });

            // Initial Render
            updateDocument();
        });

    </script>
</body>
</html>
