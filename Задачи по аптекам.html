
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–ø—Ç–µ—á–Ω–∞—è —Å–µ—Ç—å "–ê–ª–æ—ç" | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ø—Ç–µ–∫–∞–º–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #6FB644;
            --dark-green: #4CAF50;
            --bg-color: #f4f9f5;
            --text-color: #333;
            --card-bg: #ffffff;
            --shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
            --shadow-hover: 0 8px 25px rgba(76, 175, 80, 0.2);
            
            --purple: #B39DDB;
            --purple-light: rgba(179, 157, 219, 0.1);
            --pink: #F8BBD0;
            --pink-light: rgba(248, 187, 208, 0.1);
            --cyan: #80DEEA;
            --cyan-light: rgba(128, 222, 234, 0.1);
            --amber: #FFE0B2;
            --amber-light: rgba(255, 224, 178, 0.1);
            --teal: #80CBC4;
            --teal-light: rgba(128, 203, 196, 0.1);
            --red: #EF9A9A;
            --red-light: rgba(239, 154, 154, 0.1);
            --indigo: #9FA8DA;
            --indigo-light: rgba(159, 168, 218, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 10px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--primary-green) 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--primary-green);
            flex-wrap: wrap;
            gap: 10px;
            position: relative;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 200px;
        }

        .logo-container {
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .logo-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .header-text h1 {
            font-size: 20px;
            font-weight: 700;
            margin: 0 0 3px 0;
            letter-spacing: -0.5px;
        }

        .header-text p {
            font-size: 12px;
            margin: 0;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            position: relative;
        }

        .btn-header {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .btn-header:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* ===== SETTINGS MENU ===== */
        .settings-menu {
            position: absolute;
            top: 65px;
            right: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
            min-width: 200px;
            animation: slideDown 0.3s ease;
        }

        .settings-menu.active {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .settings-item {
            padding: 12px 16px;
            border-bottom: 1px solid #e0e8e3;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-color);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item:hover {
            background: var(--bg-color);
        }

        .settings-item.staff {
            color: #D81B60;
        }

        .settings-item.labels {
            color: #6A1B9A;
        }

        .settings-item.pharmacy {
            color: var(--dark-green);
        }

        /* ===== MAIN LAYOUT ===== */
        .main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #f9fdf8 0%, var(--bg-color) 100%);
            border-right: 1px solid #e0e8e3;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 0;
        }

        .sidebar-section {
            padding: 15px;
            border-bottom: 1px solid #e0e8e3;
        }

        .sidebar-title {
            font-size: 10px;
            text-transform: uppercase;
            color: #999;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 6px;
        }

        .nav-button {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid #e0e8e3;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left;
        }

        .nav-button:hover {
            border-color: #666;
            background: rgba(100, 100, 100, 0.08);
            color: #333;
            transform: translateX(4px);
        }

        .nav-button.active {
            font-weight: 600;
        }

        .nav-button.active.color-purple {
            background: linear-gradient(135deg, rgba(179, 157, 219, 0.2) 0%, rgba(179, 157, 219, 0.1) 100%);
            color: #6A1B9A;
            border-color: #B39DDB;
        }

        .nav-button.active.color-pink {
            background: linear-gradient(135deg, rgba(248, 187, 208, 0.2) 0%, rgba(248, 187, 208, 0.1) 100%);
            color: #C2185B;
            border-color: #F8BBD0;
        }

        .nav-button.active.color-cyan {
            background: linear-gradient(135deg, rgba(128, 222, 234, 0.2) 0%, rgba(128, 222, 234, 0.1) 100%);
            color: #00ACC1;
            border-color: #80DEEA;
        }

        .nav-button.active.color-amber {
            background: linear-gradient(135deg, rgba(255, 224, 178, 0.2) 0%, rgba(255, 224, 178, 0.1) 100%);
            color: #F57F17;
            border-color: #FFE0B2;
        }

        .nav-button.active.color-teal {
            background: linear-gradient(135deg, rgba(128, 203, 196, 0.2) 0%, rgba(128, 203, 196, 0.1) 100%);
            color: #00695C;
            border-color: #80CBC4;
        }

        .nav-button.active.color-red {
            background: linear-gradient(135deg, rgba(239, 154, 154, 0.2) 0%, rgba(239, 154, 154, 0.1) 100%);
            color: #C62828;
            border-color: #EF9A9A;
        }

        .nav-button.active.color-indigo {
            background: linear-gradient(135deg, rgba(159, 168, 218, 0.2) 0%, rgba(159, 168, 218, 0.1) 100%);
            color: #3F51B5;
            border-color: #9FA8DA;
        }

        .nav-delete {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .nav-button:hover .nav-delete {
            opacity: 1;
        }

        /* ===== CONTENT ===== */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            padding: 15px;
            background: white;
            border-bottom: 1px solid #e0e8e3;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .content-header h2 {
            font-size: 18px;
            color: var(--text-color);
            font-weight: 700;
        }

        .filters-toggle {
            background: linear-gradient(135deg, #A5D6D8 0%, #7CBCC4 100%);
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            margin: 15px;
            margin-bottom: 0;
            white-space: nowrap;
            overflow: hidden;
            max-width: 100%;
        }

        .filters-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .filters-box {
            background: linear-gradient(135deg, rgba(165, 214, 216, 0.08) 0%, rgba(124, 188, 196, 0.05) 100%);
            border: 2px solid rgba(165, 214, 216, 0.2);
            border-radius: 10px;
            padding: 0;
            margin: 0 15px 15px 15px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .filters-box.expanded {
            padding: 15px;
            max-height: 500px;
        }

        .filters-title {
            font-size: 11px;
            text-transform: uppercase;
            color: #7CBCC4;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
            display: none;
        }

        .filters-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .filter-label-icon {
            font-size: 14px;
        }

        .filter-select {
            padding: 8px 10px;
            border: 2px solid rgba(165, 214, 216, 0.25);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            background: white;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            border-color: #7CBCC4;
            background: rgba(165, 214, 216, 0.05);
        }

        .filter-select:focus {
            outline: none;
            border-color: #7CBCC4;
            box-shadow: 0 0 0 3px rgba(165, 214, 216, 0.1);
        }

        .filters-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .filter-clear {
            padding: 8px 12px;
            background: #FFCDD2;
            border: 2px solid #EF9A9A;
            border-radius: 6px;
            color: #C62828;
            cursor: pointer;
            font-weight: 600;
            font-size: 11px;
            transition: all 0.3s ease;
        }

        .filter-clear:hover {
            background: #F1A9A0;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 0 15px 15px 15px;
            background: var(--bg-color);
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            height: 100%;
        }

        .panel {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            border: 1px solid #e0e8e3;
            overflow: hidden;
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 3px solid transparent;
        }

        .panel.tasks .panel-header {
            border-bottom-color: var(--primary-green);
        }

        .panel.notes .panel-header {
            border-bottom-color: #FFE0B2;
        }

        .panel.all-tasks .panel-header {
            border-bottom-color: #B39DDB;
        }

        .panel.all-notes .panel-header {
            border-bottom-color: #80CBC4;
        }

        .panel-icon {
            font-size: 20px;
        }

        .panel-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-color);
        }

        .btn-add-item {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #9FA8DA 0%, #B39DDB 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-add-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(179, 157, 219, 0.2);
        }

        .items-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .item-card {
            background: var(--bg-color);
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid var(--primary-green);
            transition: all 0.3s ease;
            position: relative;
        }

        .item-card.note {
            border-left-color: #FFE0B2;
        }

        .item-card.purple-theme {
            border-left-color: #B39DDB;
        }

        .item-card.pink-theme {
            border-left-color: #F8BBD0;
        }

        .item-card.cyan-theme {
            border-left-color: #80DEEA;
        }

        .item-card.teal-theme {
            border-left-color: #80CBC4;
        }

        .item-card.red-theme {
            border-left-color: #EF9A9A;
        }

        .item-card:hover {
            background: rgba(165, 214, 216, 0.05);
            box-shadow: 0 2px 8px rgba(165, 214, 216, 0.1);
            transform: translateX(2px);
        }

        .item-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
            word-break: break-word;
        }

        .item-meta {
            font-size: 11px;
            color: #888;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tag {
            display: inline-block;
            padding: 2px 6px;
            background: rgba(165, 214, 216, 0.1);
            color: #7CBCC4;
            border-radius: 3px;
            font-weight: 600;
            font-size: 9px;
            border: 1px solid rgba(165, 214, 216, 0.2);
        }

        .tag.pharmacy {
            background: rgba(128, 222, 234, 0.15);
            color: #00ACC1;
            border-color: #80DEEA;
        }

        .tag.staff {
            background: rgba(248, 187, 208, 0.15);
            color: #C2185B;
            border-color: #F8BBD0;
        }

        .tag.deadline {
            background: rgba(255, 224, 178, 0.15);
            color: #F57F17;
            border-color: #FFE0B2;
        }

        .tag.overdue {
            background: rgba(239, 154, 154, 0.15);
            color: #C62828;
            border-color: #EF9A9A;
        }

        .tag.label1 {
            background: rgba(179, 157, 219, 0.15);
            color: #6A1B9A;
            border-color: #B39DDB;
        }

        .tag.label2 {
            background: rgba(159, 168, 218, 0.15);
            color: #3F51B5;
            border-color: #9FA8DA;
        }

        .tag.label3 {
            background: rgba(128, 203, 196, 0.15);
            color: #00695C;
            border-color: #80CBC4;
        }

        .item-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.2s, color 0.2s;
        }

        .item-card:hover .item-delete {
            opacity: 1;
            color: #EF9A9A;
        }

        .task-card {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .task-checkbox {
            width: 16px;
            height: 16px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--dark-green);
            flex-shrink: 0;
        }

        .task-card.completed .item-title {
            text-decoration: line-through;
            color: #ccc;
        }

        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: #999;
            font-size: 12px;
        }

        /* ===== MODAL ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(165, 214, 216, 0.2);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #e0e8e3;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(165, 214, 216, 0.05) 0%, rgba(124, 188, 196, 0.05) 100%);
        }

        .modal-header h2 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--text-color);
        }

        .modal-body {
            padding: 15px;
        }

        .modal-footer {
            padding: 12px 15px;
            border-top: 1px solid #e0e8e3;
            display: flex;
            gap: 8px;
            background: var(--bg-color);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-color);
            font-size: 12px;
        }

        .form-required::after {
            content: " *";
            color: #EF9A9A;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e8e3;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
            transition: all 0.3s;
            background: var(--bg-color);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #7CBCC4;
            box-shadow: 0 0 0 3px rgba(165, 214, 216, 0.1);
            background: var(--card-bg);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9FA8DA 0%, #B39DDB 100%);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(179, 157, 219, 0.2);
        }

        .btn-secondary {
            background: #e0e8e3;
            color: var(--text-color);
            border: 1px solid #d0d8d3;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #d0d8d3;
        }

        .btn-danger {
            background: #FFCDD2;
            color: #C62828;
            border: 2px solid #EF9A9A;
            padding: 4px 8px;
            font-size: 10px;
        }

        .btn-danger:hover {
            background: #F1A9A0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .table th {
            background: linear-gradient(135deg, rgba(165, 214, 216, 0.1) 0%, rgba(124, 188, 196, 0.08) 100%);
            padding: 8px;
            text-align: left;
            font-weight: 700;
            color: #7CBCC4;
            border-bottom: 2px solid #e0e8e3;
        }

        .table td {
            padding: 8px;
            border-bottom: 1px solid #e0e8e3;
        }

        .table tr:hover {
            background: rgba(165, 214, 216, 0.05);
        }

        .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .label-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: rgba(165, 214, 216, 0.1);
            color: #7CBCC4;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid rgba(165, 214, 216, 0.15);
        }

        .label-badge.color1 {
            background: rgba(179, 157, 219, 0.15);
            color: #6A1B9A;
            border-color: #B39DDB;
        }

        .label-badge.color2 {
            background: rgba(248, 187, 208, 0.15);
            color: #C2185B;
            border-color: #F8BBD0;
        }

        .label-badge.color3 {
            background: rgba(128, 222, 234, 0.15);
            color: #00ACC1;
            border-color: #80DEEA;
        }

        .label-badge.color4 {
            background: rgba(255, 224, 178, 0.15);
            color: #F57F17;
            border-color: #FFE0B2;
        }

        .label-badge.color5 {
            background: rgba(128, 203, 196, 0.15);
            color: #00695C;
            border-color: #80CBC4;
        }

        .label-badge.color6 {
            background: rgba(159, 168, 218, 0.15);
            color: #3F51B5;
            border-color: #9FA8DA;
        }

        .label-remove {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 12px;
            transition: color 0.2s;
        }

        .label-remove:hover {
            color: #C62828;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(165, 214, 216, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(165, 214, 216, 0.5);
        }

        /* ===== MOBILE ===== */
        @media (max-width: 1024px) {
            .filters-container {
                grid-template-columns: 1fr;
            }
            .grid-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                height: calc(100vh - 20px);
            }

            .header {
                padding: 12px;
            }

            .logo-section {
                width: 100%;
            }

            .header-right {
                width: 100%;
                justify-content: flex-start;
            }

            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 2px solid #e0e8e3;
                padding: 12px;
                padding-bottom: 0;
            }

            .sidebar-section {
                border-bottom: none;
                padding: 8px 0;
            }

            .sidebar-section:nth-child(2) {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                padding: 0;
            }

            .sidebar-section:nth-child(2) .sidebar-title {
                grid-column: 1 / -1;
            }

            .sidebar-section:nth-child(2) .nav-list {
                display: contents;
            }

            .sidebar-section:nth-child(2) .nav-item {
                margin-bottom: 0;
            }

            .content-header {
                padding: 12px;
            }

            .content-header h2 {
                font-size: 16px;
            }

            .filters-toggle {
                margin: 12px 12px 8px 12px;
            }

            .filters-box {
                margin: 0 12px 12px 12px;
            }

            .filters-container {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .grid-layout {
                gap: 12px;
            }

            .panel {
                padding: 12px;
            }

            .modal {
                border-radius: 8px;
            }

            .table {
                font-size: 10px;
            }

            .table th,
            .table td {
                padding: 6px;
            }

            .settings-menu {
                top: 50px;
                right: 12px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .app-container {
                height: calc(100vh - 10px);
                border-radius: 8px;
            }

            .header {
                padding: 10px;
            }

            .header-text h1 {
                font-size: 16px;
            }

            .header-text p {
                font-size: 10px;
            }

            .logo-container {
                width: 45px;
                height: 45px;
            }

            .btn-header {
                padding: 6px 8px;
                font-size: 10px;
            }

            .sidebar {
                padding: 10px;
                padding-bottom: 0;
            }

            .sidebar-section {
                padding: 6px 0;
            }

            .content-header {
                padding: 10px;
            }

            .content-header h2 {
                font-size: 14px;
            }

            .content-area {
                padding: 0 8px 8px 8px;
            }

            .filters-toggle {
                margin: 10px 8px 6px 8px;
                padding: 10px 12px;
                font-size: 12px;
            }

            .filters-box {
                margin: 0 8px 10px 8px;
                padding: 0;
            }

            .filters-box.expanded {
                padding: 10px;
            }

            .filters-container {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .filter-select {
                padding: 6px 8px;
                font-size: 11px;
            }

            .filter-label {
                font-size: 10px;
            }

            .filter-clear {
                padding: 6px 10px;
                font-size: 10px;
            }

            .grid-layout {
                gap: 10px;
            }

            .panel {
                padding: 10px;
            }

            .panel-icon {
                font-size: 18px;
            }

            .panel-title {
                font-size: 13px;
            }

            .btn-add-item {
                padding: 8px;
                font-size: 11px;
            }

            .item-card {
                padding: 8px;
            }

            .item-title {
                font-size: 12px;
            }

            .item-meta {
                font-size: 10px;
                gap: 4px;
            }

            .tag {
                padding: 1px 4px;
                font-size: 8px;
            }

            .empty-state {
                padding: 20px 10px;
                font-size: 11px;
            }

            .modal-header {
                padding: 12px;
            }

            .modal-header h2 {
                font-size: 14px;
            }

            .modal-body {
                padding: 12px;
            }

            .modal-footer {
                padding: 10px;
                gap: 6px;
            }

            .form-label {
                font-size: 11px;
                margin-bottom: 3px;
            }

            .form-input,
            .form-select,
            .form-textarea {
                padding: 6px;
                font-size: 11px;
            }

            .btn {
                padding: 6px 10px;
                font-size: 11px;
            }

            .table {
                font-size: 9px;
            }

            .table th,
            .table td {
                padding: 4px;
            }

            .label-badge {
                padding: 3px 6px;
                font-size: 9px;
            }

            .settings-menu {
                top: 40px;
                right: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HEADER -->
        <div class="header">
            <div class="logo-section">
                <div class="logo-container">
                    <img src="https://aloeapteka.ru/local/templates/aloe/favicon-600.png" alt="–õ–æ–≥–æ—Ç–∏–ø –ê–ª–æ—ç">
                </div>
                <div class="header-text">
                    <h1>–ê–ø—Ç–µ—á–Ω–∞—è —Å–µ—Ç—å ¬´–ê–ª–æ—ç¬ª</h1>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ø—Ç–µ–∫–∞–º–∏</p>
                </div>
            </div>
            <div class="header-right">
                <button class="btn-header" id="settingsBtn" onclick="toggleSettings(event)">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                
                <!-- SETTINGS MENU -->
                <div class="settings-menu" id="settingsMenu">
                    <div class="settings-item staff" onclick="openStaffModal()">
                        üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
                    </div>
                    <div class="settings-item labels" onclick="openLabelsModal()">
                        üè∑Ô∏è –Ø—Ä–ª—ã–∫–∏
                    </div>
                    <div class="settings-item pharmacy" onclick="openPharmacyManagementModal()">
                        üè• –ê–ø—Ç–µ–∫–∏
                    </div>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <!-- SIDEBAR -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <button class="nav-button" onclick="showDashboard()">
                                üìä –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">–ê–ø—Ç–µ–∫–∏</h3>
                    <ul class="nav-list" id="pharmaciesList"></ul>
                </div>
            </div>

            <!-- CONTENT -->
            <div class="content">
                <div class="content-header">
                    <h2 id="contentTitle">üìä –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª</h2>
                </div>

                <button class="filters-toggle collapsed" onclick="toggleFilters()">
                    ‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã
                </button>

                <div class="filters-box" id="filtersBox">
                    <div class="filters-container">
                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="filter-label-icon">üè•</span>
                                –ê–ø—Ç–µ–∫–∞
                            </label>
                            <select class="filter-select" id="filterPharmacy" onchange="applyFilters()">
                                <option value="">–í—Å–µ</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="filter-label-icon">üë§</span>
                                –°–æ—Ç—Ä—É–¥.
                            </label>
                            <select class="filter-select" id="filterStaff" onchange="applyFilters()">
                                <option value="">–í—Å–µ</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="filter-label-icon">üè∑Ô∏è</span>
                                –Ø—Ä–ª—ã–∫
                            </label>
                            <select class="filter-select" id="filterLabel" onchange="applyFilters()">
                                <option value="">–í—Å–µ</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="filter-label-icon">üìÖ</span>
                                –°—Ä–æ–∫
                            </label>
                            <select class="filter-select" id="filterDeadline" onchange="applyFilters()">
                                <option value="">–í—Å–µ</option>
                                <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                                <option value="week">–ù–µ–¥–µ–ª—è</option>
                                <option value="month">–ú–µ—Å—è—Ü</option>
                                <option value="overdue">–ü—Ä–æ—Å—Ä.</option>
                            </select>
                        </div>
                    </div>
                    <div class="filters-footer">
                        <button class="filter-clear" onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    </div>
                </div>

                <div class="content-area">
                    <!-- DASHBOARD VIEW WITH FILTERS -->
                    <div id="dashboardView">
                        <div class="grid-layout">
                            <div class="panel all-tasks">
                                <div class="panel-header">
                                    <span class="panel-icon">‚úì</span>
                                    <h3 class="panel-title">–ó–∞–¥–∞—á–∏</h3>
                                </div>
                                <div class="items-container" id="allTasksList"></div>
                            </div>
                            <div class="panel all-notes">
                                <div class="panel-header">
                                    <span class="panel-icon">üìù</span>
                                    <h3 class="panel-title">–ó–∞–º–µ—Ç–∫–∏</h3>
                                </div>
                                <div class="items-container" id="allNotesList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- PHARMACY VIEW -->
                    <div id="pharmacyView" class="grid-layout" style="display: none;">
                        <div class="panel notes">
                            <div class="panel-header">
                                <span class="panel-icon">üìù</span>
                                <h3 class="panel-title">–ó–∞–º–µ—Ç–∫–∏</h3>
                            </div>
                            <button class="btn-add-item" onclick="openAddNote()">
                                + –ó–∞–º–µ—Ç–∫–∞
                            </button>
                            <div class="items-container" id="pharmacyNotesList"></div>
                        </div>

                        <div class="panel tasks">
                            <div class="panel-header">
                                <span class="panel-icon">‚úì</span>
                                <h3 class="panel-title">–ó–∞–¥–∞—á–∏</h3>
                            </div>
                            <button class="btn-add-item" onclick="openAddTask()">
                                + –ó–∞–¥–∞—á–∞
                            </button>
                            <div class="items-container" id="pharmacyTasksList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MODALS ===== -->
    <div class="modal-overlay" id="pharmacyManagementModal" onclick="if(event.target===this) closeModal('pharmacyManagementModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ê–ø—Ç–µ–∫–∞–º–∏</h2>
                <button class="modal-close" onclick="closeModal('pharmacyManagementModal')">√ó</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="openCreatePharmacy()">
                    + –ù–æ–≤–∞—è –∞–ø—Ç–µ–∫–∞
                </button>
                <div id="pharmacyManagementList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('pharmacyManagementModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="createPharmacyModal" onclick="if(event.target===this) closeModal('createPharmacyModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞—Ç—å –ê–ø—Ç–µ–∫—É</h2>
                <button class="modal-close" onclick="closeModal('createPharmacyModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label form-required">–ù–æ–º–µ—Ä –∞–ø—Ç–µ–∫–∏</label>
                    <input type="text" id="pharmacyNumberInput" class="form-input" placeholder="1">
                </div>
                <div class="form-group">
                    <label class="form-label form-required">–ê–¥—Ä–µ—Å</label>
                    <input type="text" id="pharmacyAddressInput" class="form-input" placeholder="—É–ª. –ë–æ–ª—å—à–∞—è –ü–æ–∫—Ä–æ–≤—Å–∫–∞—è, –¥. 1">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="createPharmacy()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('createPharmacyModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editPharmacyModal" onclick="if(event.target===this) closeModal('editPharmacyModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ê–ø—Ç–µ–∫—É</h2>
                <button class="modal-close" onclick="closeModal('editPharmacyModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label form-required">–ù–æ–º–µ—Ä –∞–ø—Ç–µ–∫–∏</label>
                    <input type="text" id="editPharmacyNumberInput" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label form-required">–ê–¥—Ä–µ—Å</label>
                    <input type="text" id="editPharmacyAddressInput" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveEditedPharmacy()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('editPharmacyModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addNoteModal" onclick="if(event.target===this) closeModal('addNoteModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–ù–æ–≤–∞—è –ó–∞–º–µ—Ç–∫–∞</h2>
                <button class="modal-close" onclick="closeModal('addNoteModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label form-required">–¢–µ–∫—Å—Ç</label>
                    <textarea id="noteTextInput" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveNote()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('addNoteModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addTaskModal" onclick="if(event.target===this) closeModal('addTaskModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–ù–æ–≤–∞—è –ó–∞–¥–∞—á–∞</h2>
                <button class="modal-close" onclick="closeModal('addTaskModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label form-required">–ó–∞–¥–∞—á–∞</label>
                    <input type="text" id="taskTitleInput" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ...">
                </div>
                <div class="form-group">
                    <label class="form-label">–Ø—Ä–ª—ã–∫</label>
                    <select id="taskLabelInput" class="form-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Ç–≤–µ—Ç—Å—Ç–≤.</label>
                    <select id="taskStaffInput" class="form-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–°—Ä–æ–∫</label>
                    <input type="date" id="taskDeadlineInput" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveTask()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('addTaskModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="staffModal" onclick="if(event.target===this) closeModal('staffModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
                <button class="modal-close" onclick="closeModal('staffModal')">√ó</button>
            </div>
            <div class="modal-body">
                <h3 style="font-size: 13px; margin-bottom: 10px; color: var(--text-color); font-weight: 700;">–î–æ–±–∞–≤–∏—Ç—å</h3>
                <div class="form-group">
                    <label class="form-label form-required">–§–ò–û</label>
                    <input type="text" id="staffNameInput" class="form-input" placeholder="–§–ò–û">
                </div>
                <div class="form-group">
                    <label class="form-label form-required">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" id="staffPositionInput" class="form-input" placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="staffPhoneInput" class="form-input" placeholder="+7 (900) 123-45-67">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="staffEmailInput" class="form-input" placeholder="email@example.com">
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="addStaff()">–î–æ–±–∞–≤–∏—Ç—å</button>

                <h3 style="font-size: 13px; margin-bottom: 10px; color: var(--text-color); font-weight: 700;">–°–ø–∏—Å–æ–∫</h3>
                <div id="staffTableContainer"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('staffModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="labelsModal" onclick="if(event.target===this) closeModal('labelsModal')">
        <div class="modal">
            <div class="modal-header">
                <h2>–Ø—Ä–ª—ã–∫–∏</h2>
                <button class="modal-close" onclick="closeModal('labelsModal')">√ó</button>
            </div>
            <div class="modal-body">
                <h3 style="font-size: 13px; margin-bottom: 10px; color: var(--text-color); font-weight: 700;">–î–æ–±–∞–≤–∏—Ç—å</h3>
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <input type="text" id="newLabelInput" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." style="flex: 1;">
                    <button class="btn btn-primary" style="flex: 0 0 80px; font-size: 11px;" onclick="addLabel()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>

                <h3 style="font-size: 13px; margin-bottom: 10px; color: var(--text-color); font-weight: 700;">–¢–µ–∫—É—â–∏–µ</h3>
                <div class="labels-container" id="labelsListContainer"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('labelsModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js";
        import { getDatabase, ref, set, get, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCXU_qtA65zudpgUsdNdbndOSpuGRbEJ2c",
            authDomain: "pharmacy-manager-d7802.firebaseapp.com",
            projectId: "pharmacy-manager-d7802",
            storageBucket: "pharmacy-manager-d7802.firebasestorage.app",
            messagingSenderId: "60028648458",
            appId: "1:60028648458:web:45e2a124ea3b7d7c46f3f3",
            measurementId: "G-JSR0JKT31B",
            databaseURL: "https://pharmacy-manager-d7802-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        window.firebaseDB = {
            database,
            ref,
            set,
            get,
            remove,
            onValue
        };
    </script>

    <script>
        let appData = {
            pharmacies: [],
            currentPharmacy: null,
            staff: [
                { id: 'staff_1', name: '–ë–æ—á–∞—Ä–æ–≤–∞ –ê.–í.', position: '–î–∏—Ä–µ–∫—Ç–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞', phone: '+7 (904) 252-31-00', email: 'a.bocharova@aloea.ru' },
                { id: 'staff_2', name: '–ö–æ—à–µ–ª–µ–≤–∞ –ï.–ê.', position: '–î–∏—Ä–µ–∫—Ç–æ—Ä –†–µ–≥–∏–æ–Ω–∞', phone: '+7 (904) 653-29-38', email: 'e.kosheleva@aloea.ru' },
                { id: 'staff_3', name: '–ö–ª—é–∫–∏–Ω –°.–ù.', position: '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä', phone: '+7 (904) 041-00-17', email: 's.klyukin@aloea.ru' },
                { id: 'staff_4', name: '–í–æ—Å—Ç–æ–∫–æ–≤–∞ –Æ.–í.', position: '–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É', phone: '+7 (919) 025-15-98', email: 'y.vostokova@aloea.ru' },
                { id: 'staff_5', name: '–ü–∞–≤–ª–æ–≤ –ê.–§.', position: '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', phone: '+7 (920) 916-97-09', email: 'a.pavlov@aloea.ru' },
                { id: 'staff_6', name: '–ì–∞—Ä–≤–∏–Ω –†.', position: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ê–•–û', phone: '+7 (904) 857-73-73', email: 'r.gavrin@aloea.ru' },
                { id: 'staff_7', name: '–ì–æ—Ä–æ—à–∏–ª–æ–≤–∞ –ù.–ù.', position: '–°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä', phone: '+7 (953) 343-59-36', email: 'n.goroshilova@aloea.ru' },
                { id: 'staff_8', name: '–ú–∞—à–µ—Ä–∏—á–µ–≤–∞ –ú.–ê.', position: '–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥', phone: '+7 (999) 799-36-06', email: 'm.evstrat@aloea.ru' }
            ],
            labels: ['–°—Ä–æ—á–Ω–æ', '–í–∞–∂–Ω–æ', '–†–µ–≥—É–ª—è—Ä–Ω–æ', '–†–µ–∫–ª–∞–º–∞', '–ê–•–û', '–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤']
        };

        let currentFilters = {
            pharmacy: '',
            staff: '',
            label: '',
            deadline: ''
        };

        const colorClasses = ['color1', 'color2', 'color3', 'color4', 'color5', 'color6'];
        const pharmacyColors = ['color-purple', 'color-pink', 'color-cyan', 'color-amber', 'color-teal', 'color-red', 'color-indigo'];
        const labelClasses = ['label1', 'label2', 'label3', 'label1', 'label2', 'label3'];

        let editingPharmacyId = null;

        function toggleSettings(e) {
            e.stopPropagation();
            const menu = document.getElementById('settingsMenu');
            menu.classList.toggle('active');
        }

        document.addEventListener('click', function(e) {
            const menu = document.getElementById('settingsMenu');
            const btn = document.getElementById('settingsBtn');
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.remove('active');
            }
        });

        function toggleFilters() {
            const filtersBox = document.getElementById('filtersBox');
            const button = document.querySelector('.filters-toggle');
            
            filtersBox.classList.toggle('expanded');
            button.classList.toggle('collapsed');
            button.classList.toggle('expanded');
        }

        function loadData() {
            const saved = localStorage.getItem('pharmacyAppData');
            if (saved) {
                const loaded = JSON.parse(saved);
                appData.pharmacies = loaded.pharmacies || appData.pharmacies;
                appData.currentPharmacy = loaded.currentPharmacy || appData.currentPharmacy;
                appData.labels = loaded.labels || appData.labels;
                appData.staff = loaded.staff || appData.staff;
            }
        }

        function saveData() {
            const dataToSave = {
                pharmacies: appData.pharmacies,
                currentPharmacy: appData.currentPharmacy,
                labels: appData.labels,
                staff: appData.staff
            };
            localStorage.setItem('pharmacyAppData', JSON.stringify(dataToSave));
        }

        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // PHARMACIES
        function openPharmacyManagementModal() {
            renderPharmacyManagementList();
            openModal('pharmacyManagementModal');
            document.getElementById('settingsMenu').classList.remove('active');
        }

        function renderPharmacyManagementList() {
            const container = document.getElementById('pharmacyManagementList');
            if (!appData.pharmacies.length) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –∞–ø—Ç–µ–∫</div>';
                return;
            }

            let html = '<table class="table"><thead><tr><th>‚Ññ</th><th>–ê–¥—Ä–µ—Å</th><th></th></tr></thead><tbody>';
            appData.pharmacies.forEach(p => {
                html += `<tr>
                    <td>${p.number}</td>
                    <td>${p.address}</td>
                    <td style="text-align: right;">
                        <button class="btn btn-danger" onclick="openEditPharmacy(${p.id})" style="margin-right: 4px;">‚úé</button>
                        <button class="btn btn-danger" onclick="deletePharmacy(${p.id})">‚úï</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function openCreatePharmacy() {
            document.getElementById('pharmacyNumberInput').value = '';
            document.getElementById('pharmacyAddressInput').value = '';
            openModal('createPharmacyModal');
            document.getElementById('pharmacyNumberInput').focus();
        }

        function createPharmacy() {
            const number = document.getElementById('pharmacyNumberInput').value.trim();
            const address = document.getElementById('pharmacyAddressInput').value.trim();

            if (!number || !address) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –∏ –∞–¥—Ä–µ—Å –∞–ø—Ç–µ–∫–∏');

            const name = `–ê–ø—Ç–µ–∫–∞ ‚Ññ${number}`;

            appData.pharmacies.push({ 
                id: Date.now(), 
                name,
                number,
                address,
                notes: [], 
                tasks: [] 
            });
            saveData();
            renderPharmacies();
            updateFilterOptions();
            renderPharmacyManagementList();
            closeModal('createPharmacyModal');
        }

        function openEditPharmacy(id) {
            const pharmacy = appData.pharmacies.find(p => p.id === id);
            if (!pharmacy) return;

            editingPharmacyId = id;
            document.getElementById('editPharmacyNumberInput').value = pharmacy.number || '';
            document.getElementById('editPharmacyAddressInput').value = pharmacy.address || '';
            openModal('editPharmacyModal');
        }

        function saveEditedPharmacy() {
            const pharmacy = appData.pharmacies.find(p => p.id === editingPharmacyId);
            if (!pharmacy) return alert('–ê–ø—Ç–µ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');

            const number = document.getElementById('editPharmacyNumberInput').value.trim();
            const address = document.getElementById('editPharmacyAddressInput').value.trim();

            if (!number || !address) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –∏ –∞–¥—Ä–µ—Å –∞–ø—Ç–µ–∫–∏');

            pharmacy.number = number;
            pharmacy.address = address;
            pharmacy.name = `–ê–ø—Ç–µ–∫–∞ ‚Ññ${number}`;

            saveData();
            renderPharmacies();
            renderPharmacyManagementList();
            updateFilterOptions();
            if (appData.currentPharmacy === pharmacy.id) showPharmacy();
            closeModal('editPharmacyModal');
            editingPharmacyId = null;
        }

        function deletePharmacy(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∞–ø—Ç–µ–∫—É?')) return;
            appData.pharmacies = appData.pharmacies.filter(p => p.id !== id);
            if (appData.currentPharmacy === id) appData.currentPharmacy = null;
            saveData();
            renderPharmacies();
            renderPharmacyManagementList();
            updateFilterOptions();
            showDashboard();
        }

        function selectPharmacy(id) {
            appData.currentPharmacy = id;
            saveData();
            renderPharmacies();
            showPharmacy();
        }

        function renderPharmacies() {
            const list = document.getElementById('pharmaciesList');
            list.innerHTML = '';
            appData.pharmacies.forEach((p, idx) => {
                const colorClass = pharmacyColors[idx % pharmacyColors.length];
                const li = document.createElement('li');
                li.className = 'nav-item';
                li.innerHTML = `
                    <button class="nav-button ${appData.currentPharmacy === p.id ? 'active ' + colorClass : ''}" onclick="selectPharmacy(${p.id})">
                        <span>‚Ññ${p.number}</span>
                        <button class="nav-delete" onclick="deletePharmacy(${p.id}); event.stopPropagation();">‚úï</button>
                    </button>
                `;
                list.appendChild(li);
            });
        }

        // NOTES
        function openAddNote() {
            if (!appData.currentPharmacy) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –∞–ø—Ç–µ–∫—É');
            document.getElementById('noteTextInput').value = '';
            openModal('addNoteModal');
            document.getElementById('noteTextInput').focus();
        }

        function saveNote() {
            const text = document.getElementById('noteTextInput').value.trim();
            if (!text) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç');
            const pharmacy = appData.pharmacies.find(p => p.id === appData.currentPharmacy);
            if (pharmacy) {
                pharmacy.notes.unshift({ text, date: new Date().toISOString() });
                saveData();
                renderPharmacy();
                renderDashboard();
                closeModal('addNoteModal');
            }
        }

        function deleteNote(noteIdx) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
            const pharmacy = appData.pharmacies.find(p => p.id === appData.currentPharmacy);
            if (pharmacy) {
                pharmacy.notes.splice(noteIdx, 1);
                saveData();
                renderPharmacy();
                renderDashboard();
            }
        }

        // TASKS
        function openAddTask() {
            if (!appData.currentPharmacy) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –∞–ø—Ç–µ–∫—É');
            document.getElementById('taskTitleInput').value = '';
            document.getElementById('taskLabelInput').value = '';
            document.getElementById('taskStaffInput').value = '';
            document.getElementById('taskDeadlineInput').value = '';
            updateTaskSelects();
            openModal('addTaskModal');
            document.getElementById('taskTitleInput').focus();
        }

        function saveTask() {
            const title = document.getElementById('taskTitleInput').value.trim();
            if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
            const pharmacy = appData.pharmacies.find(p => p.id === appData.currentPharmacy);
            if (pharmacy) {
                pharmacy.tasks.unshift({
                    title,
                    label: document.getElementById('taskLabelInput').value,
                    staffId: document.getElementById('taskStaffInput').value,
                    deadline: document.getElementById('taskDeadlineInput').value,
                    completed: false
                });
                saveData();
                renderPharmacy();
                renderDashboard();
                closeModal('addTaskModal');
            }
        }

        function toggleTask(taskIdx) {
            const pharmacy = appData.pharmacies.find(p => p.id === appData.currentPharmacy);
            if (pharmacy && pharmacy.tasks[taskIdx]) {
                pharmacy.tasks[taskIdx].completed = !pharmacy.tasks[taskIdx].completed;
                saveData();
                renderPharmacy();
                renderDashboard();
            }
        }

        function deleteTask(taskIdx) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
            const pharmacy = appData.pharmacies.find(p => p.id === appData.currentPharmacy);
            if (pharmacy) {
                pharmacy.tasks.splice(taskIdx, 1);
                saveData();
                renderPharmacy();
                renderDashboard();
            }
        }

        // STAFF
        function openStaffModal() {
            renderStaffTable();
            openModal('staffModal');
            document.getElementById('settingsMenu').classList.remove('active');
        }

        function addStaff() {
            const name = document.getElementById('staffNameInput').value.trim();
            const position = document.getElementById('staffPositionInput').value.trim();
            if (!name || !position) return alert('–§–ò–û –∏ –î–æ–ª–∂–Ω–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã');
            appData.staff.push({
                id: 'staff_' + Date.now(),
                name, position,
                phone: document.getElementById('staffPhoneInput').value.trim(),
                email: document.getElementById('staffEmailInput').value.trim()
            });
            saveData();
            renderStaffTable();
            updateTaskSelects();
            updateFilterOptions();
            document.getElementById('staffNameInput').value = '';
            document.getElementById('staffPositionInput').value = '';
            document.getElementById('staffPhoneInput').value = '';
            document.getElementById('staffEmailInput').value = '';
        }

        function deleteStaff(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
            appData.staff = appData.staff.filter(s => s.id !== id);
            saveData();
            renderStaffTable();
            updateTaskSelects();
            updateFilterOptions();
        }

        function renderStaffTable() {
            const container = document.getElementById('staffTableContainer');
            if (!appData.staff.length) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>';
                return;
            }
            let html = '<table class="table"><thead><tr><th>–§–ò–û</th><th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th><th>–¢–µ–ª.</th><th></th></tr></thead><tbody>';
            appData.staff.forEach(s => {
                html += `<tr><td>${s.name}</td><td>${s.position}</td><td><a href="tel:${s.phone}" style="color: #7CBCC4; text-decoration: none; font-size: 10px;">${s.phone}</a></td><td><button class="btn btn-danger" onclick="deleteStaff('${s.id}')">X</button></td></tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // LABELS
        function openLabelsModal() {
            renderLabelsList();
            openModal('labelsModal');
            document.getElementById('settingsMenu').classList.remove('active');
        }

        function addLabel() {
            const name = document.getElementById('newLabelInput').value.trim();
            if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
            if (appData.labels.includes(name)) return alert('–°—É—â–µ—Å—Ç–≤—É–µ—Ç');
            appData.labels.push(name);
            saveData();
            renderLabelsList();
            updateTaskSelects();
            updateFilterOptions();
            document.getElementById('newLabelInput').value = '';
        }

        function deleteLabel(name) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
            appData.labels = appData.labels.filter(l => l !== name);
            saveData();
            renderLabelsList();
            updateTaskSelects();
            updateFilterOptions();
        }

        function renderLabelsList() {
            const container = document.getElementById('labelsListContainer');
            if (!appData.labels.length) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç —è—Ä–ª—ã–∫–æ–≤</div>';
                return;
            }
            let html = '';
            appData.labels.forEach((l, idx) => {
                const colorClass = colorClasses[idx % colorClasses.length];
                html += `<div class="label-badge ${colorClass}">${l}<button class="label-remove" onclick="deleteLabel('${l}')" style="cursor: pointer;">‚úï</button></div>`;
            });
            container.innerHTML = html;
        }

        function updateTaskSelects() {
            let labelHtml = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>';
            appData.labels.forEach(l => { labelHtml += `<option value="${l}">${l}</option>`; });
            document.getElementById('taskLabelInput').innerHTML = labelHtml;

            let staffHtml = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>';
            appData.staff.forEach(s => { staffHtml += `<option value="${s.id}">${s.name}</option>`; });
            document.getElementById('taskStaffInput').innerHTML = staffHtml;
        }

        // FILTERS
        function updateFilterOptions() {
            let pharmacyHtml = '<option value="">–í—Å–µ</option>';
            appData.pharmacies.forEach(p => {
                pharmacyHtml += `<option value="${p.id}">‚Ññ${p.number} ‚Äî ${p.address}</option>`;
            });
            document.getElementById('filterPharmacy').innerHTML = pharmacyHtml;

            let staffHtml = '<option value="">–í—Å–µ</option>';
            appData.staff.forEach(s => {
                staffHtml += `<option value="${s.id}">${s.name}</option>`;
            });
            document.getElementById('filterStaff').innerHTML = staffHtml;

            let labelHtml = '<option value="">–í—Å–µ</option>';
            appData.labels.forEach(l => {
                labelHtml += `<option value="${l}">${l}</option>`;
            });
            document.getElementById('filterLabel').innerHTML = labelHtml;
        }

        function applyFilters() {
            currentFilters.pharmacy = document.getElementById('filterPharmacy').value;
            currentFilters.staff = document.getElementById('filterStaff').value;
            currentFilters.label = document.getElementById('filterLabel').value;
            currentFilters.deadline = document.getElementById('filterDeadline').value;
            renderDashboard();
        }

        function clearFilters() {
            currentFilters = { pharmacy: '', staff: '', label: '', deadline: '' };
            document.getElementById('filterPharmacy').value = '';
            document.getElementById('filterStaff').value = '';
            document.getElementById('filterLabel').value = '';
            document.getElementById('filterDeadline').value = '';
            renderDashboard();
        }

        function matchesFilters(task) {
            if (currentFilters.pharmacy && task.pharmacyId != currentFilters.pharmacy) return false;
            if (currentFilters.staff && task.staffId !== currentFilters.staff) return false;
            if (currentFilters.label && task.label !== currentFilters.label) return false;
            if (currentFilters.deadline) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const deadline = task.deadline ? new Date(task.deadline) : null;

                if (!deadline) return false;

                switch (currentFilters.deadline) {
                    case 'today':
                        return deadline.getTime() === today.getTime();
                    case 'week':
                        const weekEnd = new Date(today);
                        weekEnd.setDate(weekEnd.getDate() + 7);
                        return deadline >= today && deadline <= weekEnd;
                    case 'month':
                        return deadline.getMonth() === today.getMonth() && deadline.getFullYear() === today.getFullYear();
                    case 'overdue':
                        return deadline < today && !task.completed;
                }
            }

            return true;
        }

        // RENDERING
        function renderPharmacy() {
            const pharmacy = appData.pharmacies.find(p => p.id === appData.currentPharmacy);
            if (!pharmacy) return;

            document.getElementById('contentTitle').textContent = `üì¶ –ê–ø—Ç–µ–∫–∞ ‚Ññ${pharmacy.number} ‚Äî ${pharmacy.address}`;

            let notesHtml = '';
            if (!pharmacy.notes.length) {
                notesHtml = '<div class="empty-state">–ù–µ—Ç</div>';
            } else {
                pharmacy.notes.forEach((note, idx) => {
                    notesHtml += `
                        <div class="item-card note">
                            <div class="item-title">${note.text}</div>
                            <div class="item-meta">${new Date(note.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })}</div>
                            <button class="item-delete" onclick="deleteNote(${idx})">‚úï</button>
                        </div>
                    `;
                });
            }
            document.getElementById('pharmacyNotesList').innerHTML = notesHtml;

            let tasksHtml = '';
            if (!pharmacy.tasks.length) {
                tasksHtml = '<div class="empty-state">–ù–µ—Ç</div>';
            } else {
                pharmacy.tasks.forEach((task, idx) => {
                    const staff = appData.staff.find(s => s.id === task.staffId);
                    const deadline = task.deadline ? new Date(task.deadline) : null;
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const isOverdue = deadline && deadline < today && !task.completed;

                    let tagsHtml = '';
                    const labelIdx = appData.labels.indexOf(task.label);
                    if (task.label) tagsHtml += `<span class="tag ${labelClasses[labelIdx % labelClasses.length]}">${task.label}</span>`;
                    if (staff) tagsHtml += `<span class="tag staff">${staff.name}</span>`;
                    if (deadline) tagsHtml += `<span class="tag ${isOverdue ? 'overdue' : 'deadline'}">üìÖ ${deadline.toLocaleDateString('ru-RU', {day: 'numeric', month: 'short'})}</span>`;

                    tasksHtml += `
                        <div class="item-card task-card ${task.completed ? 'completed' : ''}">
                            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${idx})">
                            <div style="flex: 1;">
                                <div class="item-title">${task.title}</div>
                                <div class="item-meta">${tagsHtml}</div>
                            </div>
                            <button class="item-delete" onclick="deleteTask(${idx})">‚úï</button>
                        </div>
                    `;
                });
            }
            document.getElementById('pharmacyTasksList').innerHTML = tasksHtml;
        }

        function renderDashboard() {
            let allTasks = [];
            appData.pharmacies.forEach(p => {
                p.tasks.forEach((t, idx) => {
                    allTasks.push({ ...t, pharmacyId: p.id, pharmacyName: `‚Ññ${p.number} ‚Äî ${p.address}`, taskIdx: idx });
                });
            });

            const filteredTasks = allTasks.filter(t => matchesFilters(t));
            let tasksHtml = '';
            if (!filteredTasks.length) {
                tasksHtml = '<div class="empty-state">–ù–µ—Ç –∑–∞–¥–∞—á</div>';
            } else {
                filteredTasks.forEach(t => {
                    const staff = appData.staff.find(s => s.id === t.staffId);
                    const deadline = t.deadline ? new Date(t.deadline) : null;
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const isOverdue = deadline && deadline < today && !t.completed;

                    let tagsHtml = `<span class="tag pharmacy">${t.pharmacyName}</span>`;
                    const labelIdx = appData.labels.indexOf(t.label);
                    if (t.label) tagsHtml += `<span class="tag ${labelClasses[labelIdx % labelClasses.length]}">${t.label}</span>`;
                    if (staff) tagsHtml += `<span class="tag staff">${staff.name}</span>`;
                    if (deadline) tagsHtml += `<span class="tag ${isOverdue ? 'overdue' : 'deadline'}">üìÖ ${deadline.toLocaleDateString('ru-RU', {day: 'numeric', month: 'short'})}</span>`;

                    tasksHtml += `
                        <div class="item-card task-card ${t.completed ? 'completed' : ''}">
                            <input type="checkbox" class="task-checkbox" ${t.completed ? 'checked' : ''} onchange="toggleAllTask('${t.pharmacyId}', ${t.taskIdx})">
                            <div style="flex: 1;">
                                <div class="item-title">${t.title}</div>
                                <div class="item-meta">${tagsHtml}</div>
                            </div>
                        </div>
                    `;
                });
            }
            document.getElementById('allTasksList').innerHTML = tasksHtml;

            let allNotes = [];
            appData.pharmacies.forEach(p => {
                p.notes.forEach(n => {
                    allNotes.push({ ...n, pharmacyName: `‚Ññ${p.number} ‚Äî ${p.address}`, pharmacyId: p.id });
                });
            });

            let notesHtml = '';
            if (!allNotes.length) {
                notesHtml = '<div class="empty-state">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</div>';
            } else {
                allNotes.forEach(n => {
                    const match = !currentFilters.pharmacy || n.pharmacyId == currentFilters.pharmacy;
                    if (match) {
                        notesHtml += `
                            <div class="item-card note">
                                <div class="item-title">${n.text}</div>
                                <div class="item-meta"><span class="tag pharmacy">${n.pharmacyName}</span> ${new Date(n.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })}</div>
                            </div>
                        `;
                    }
                });
            }
            document.getElementById('allNotesList').innerHTML = notesHtml;
        }

        function toggleAllTask(pharmacyId, taskIdx) {
            const pharmacy = appData.pharmacies.find(p => p.id === pharmacyId);
            if (pharmacy && pharmacy.tasks[taskIdx]) {
                pharmacy.tasks[taskIdx].completed = !pharmacy.tasks[taskIdx].completed;
                saveData();
                renderDashboard();
            }
        }

        // NAVIGATION
        function showDashboard() {
            document.querySelector('.nav-button.active')?.classList.remove('active');
            document.querySelector('.sidebar-section:first-child .nav-button')?.classList.add('active');
            document.getElementById('dashboardView').style.display = '';
            document.getElementById('pharmacyView').style.display = 'none';
            document.getElementById('contentTitle').textContent = 'üìä –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª';
            updateFilterOptions();
            renderDashboard();
        }

        function showPharmacy() {
            document.getElementById('dashboardView').style.display = 'none';
            document.getElementById('pharmacyView').style.display = '';
            renderPharmacy();
        }

        loadData();
        renderPharmacies();
        updateFilterOptions();
        renderDashboard();
    </script>
</body>
</html>
